/*! This is uglify test - 2019-09-15 */
var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define(["require","exports","./indexedDB","./md","./article","./style","./request","jquery"],function(e,t,n,i,r,o,a,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),d=__importDefault(d);function l(t,r){null!=g&&clearTimeout(g),g=setTimeout(function(){y.style.display="block",_.is_save=!1;var e=r.value;""!==e&&(_[t]=e,n.idb.add(_,p,function(e){o.alerter(e.msg)})),"content"===t&&(w.innerHTML=i.md(e),k.value=i.md(e))},1e3)}var c=document.querySelector("#form-title"),u=document.querySelector("#form-content"),s=document.querySelector("#form-category"),v=document.querySelector("#form-keywords"),f=document.querySelector(".artic-save"),y=(document.querySelector(".artic-down"),document.querySelector(".sub")),m=document.querySelector(".artic-post"),b=document.querySelector("#email"),p=1,w=document.querySelector(".effect-preview"),k=document.querySelector(".code-preview"),_={id:p,title:"",content:"",category:"",keywords:"",is_save:!1},g=null;t.delay_save=l;t.action=function(){n.idb.connect("article"),c.setAttribute("readonly",!0),u.setAttribute("readonly",!0),s.setAttribute("readonly",!0),v.setAttribute("readonly",!0),setTimeout(function(){n.idb.count(function(e){p=e.data.result+1,_.id=p}),c.removeAttribute("readonly"),u.removeAttribute("readonly"),s.removeAttribute("readonly"),v.removeAttribute("readonly"),A(function(e){d.default("#c-left ul").empty(),d.default("#c-left ul").append(e)})},1e3),c.value="",u.value="",s.value="",v.value="",c.addEventListener("keydown",function(e){l("title",c)}),u.addEventListener("keydown",function(e){l("content",u)}),s.addEventListener("keydown",function(e){l("category",s)}),v.addEventListener("keydown",function(e){l("keywords",v)}),f.addEventListener("click",function(e){q()}),m.addEventListener("click",function(){S()}),d.default("#c-left").on("click","a",function(e){var t=e.target.dataset.articleId;n.idb.read(parseInt(t),function(e){if(2001==e.code){var t=e.data.result;c.value=t.title,u.value=t.content,s.value=t.category,v.value=t.keywords,_.id=t.id,_.title=t.title,_.content=t.content,_.category=t.category,_.keywords=t.keywords,p=t.id,w.innerHTML=i.md(t.content),k.value=i.md(t.content)}else o.alerter(e.msg)})})};var q=function(){""==_.title?o.alerter("标题不能为空！"):""==_.content?o.alerter("内容不能为空！"):""==_.category?o.alerter("分类不能为空！"):""==_.keywords?o.alerter("关键字不能为空！"):(y.style.display="none",_.is_save=!0,r.article.add(_),n.idb.add(_,p,function(e){o.alerter(e.msg)}))},S=function(){if(_.is_save)if(""==b.value)o.alerter("邮箱不能为空！");else{var e={url:"http://static.codeinfo.top/mail/index/send",data:{author:"gzwawj.",title:_.title,content:i.md(_.content),email:b.value},method:"POST"};a.req.text(e,function(e){o.alerter(e.msg)})}else o.alerter("请先保存文章！")},A=function(i){n.idb.lst(1,function(e){if(e.code=2001){var t="",r=e.data.result;for(var n in r)t+='\n                    <li>\n                        <div class="article-item">\n                            <div class="title"><a href="javascript:void(0)" data-article-id='+r[n].id+">"+r[n].title+"</a></div>\n                            <div>分类:"+r[n].category+"</div>\n                            <div>关键字:"+r[n].keywords+"</div>\n                            <div>时间:</div>\n                        </div>\n                    </li>";i(t)}else o.alerter(e.msg)})};t.list_article=A});